---
# Dynamic Traefik configuration for Coolify services
# This file is automatically generated by Ansible.
# Do not edit it manually (only if you know what are you doing).

http:
  middlewares:
    redirect-to-https:
      redirectscheme:
        scheme: https
    security-headers:
      headers:
        frameDeny: true
        contentTypeNosniff: true
        browserXssFilter: true
        referrerPolicy: no-referrer-when-downgrade
        sslRedirect: true
        stsSeconds: 31536000
        stsIncludeSubdomains: true
        stsPreload: true
    gzip:
      compress: true

  routers:
    coolify-http:
      entryPoints:
        - http
      middlewares:
        - redirect-to-https
      service: coolify
      rule: Host(`{{ public_domain }}`) || Host(`coolify.{{ public_domain }}`)
    
    coolify-realtime-ws:
      entryPoints:
        - http
      service: coolify-realtime
      rule: (Host(`{{ public_domain }}`) || Host(`realtime.{{ public_domain }}`) || Host(`coolify.{{ public_domain }}`)) && PathPrefix(`/app`)
    
    coolify-terminal-ws:
      entryPoints:
        - http
      service: coolify-terminal
      rule: (Host(`{{ public_domain }}`) || Host(`coolify.{{ public_domain }}`)) && PathPrefix(`/terminal/ws`)
    
    coolify-https:
      entryPoints:
        - https
      service: coolify
      rule: Host(`{{ public_domain }}`) || Host(`coolify.{{ public_domain }}`)
      tls:
        certResolver: ovh
    
    coolify-realtime-wss:
      entryPoints:
        - https
      service: coolify-realtime
      rule: (Host(`{{ public_domain }}`) || Host(`realtime.{{ public_domain }}`) || Host(`coolify.{{ public_domain }}`)) && PathPrefix(`/app`)
      tls:
        certResolver: ovh
    
    coolify-terminal-wss:
      entryPoints:
        - https
      service: coolify-terminal
      rule: (Host(`{{ public_domain }}`) || Host(`coolify.{{ public_domain }}`)) && PathPrefix(`/terminal/ws`)
      tls:
        certResolver: ovh

  services:
    coolify:
      loadBalancer:
        servers:
          - url: http://coolify:8080
    
    coolify-realtime:
      loadBalancer:
        servers:
          - url: http://soketi:6001
    
    coolify-terminal:
      loadBalancer:
        servers:
          - url: http://soketi:6002