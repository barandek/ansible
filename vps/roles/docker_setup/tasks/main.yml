---
- name: Install Docker (RedHat)
  include_tasks: redhat.yml
  when: ansible_os_family == "RedHat"
  tags: [docker, coolify]

- name: Install Docker (Debian)
  include_tasks: debian.yml
  when: ansible_os_family == "Debian"
  tags: [docker, coolify]

- name: Start and enable Docker
  systemd:
    name: docker
    state: started
    enabled: yes
  tags: [docker, coolify]

- name: Add user to docker group
  user:
    name: "{{ ansible_user }}"
    groups: docker
    append: yes
  when: ansible_user != "root"
  tags: [docker, coolify]

- name: Verify Docker installation
  command: docker --version
  changed_when: false
  tags: [docker, coolify]

- name: Verify Docker Compose installation
  command: docker compose version
  changed_when: false
  tags: [docker, coolify]
