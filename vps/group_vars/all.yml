---
# Multi-Host Configuration
# This file uses vault variables for sensitive data

# =============================================================================
# SSH CONFIGURATION
# =============================================================================
ssh_key_dir: "~/.ssh"
ssh_key_name: "{{ inventory_hostname }}_{{ ansible_user }}_key"
ssh_port: 22
ssh_max_auth_tries: 3
ssh_client_alive_interval: 300
ssh_client_alive_count_max: 2

# =============================================================================
# DEPLOYMENT PLATFORM CONFIGURATION
# =============================================================================
# Supported platforms: coolify, dokploy
# server_role should be set per-host in vault/inventory
server_role: "coolify"

# Domain and DNS configuration
public_domain: "example.com"
acme_email: "this@example.com"

# OVH DNS Provider Configuration
ovh_endpoint: "ovh-eu"
ovh_application_key: "{{ vault_ovh_application_key }}"
ovh_application_secret: "{{ vault_ovh_application_secret }}"
ovh_consumer_key: "{{ vault_ovh_consumer_key }}"

# =============================================================================
# PLATFORM-SPECIFIC CONFIGURATION
# =============================================================================
# Feature flag: expose platform ports publicly (default: false for security)
expose_platform_ports: false

# Coolify ports (when expose_platform_ports is true)
coolify_ports:
  - { port: 8000, proto: 'tcp', rule: 'allow', comment: 'Coolify dashboard' }
  - { port: 6001, proto: 'tcp', rule: 'allow', comment: 'Coolify realtime' }
  - { port: 6002, proto: 'tcp', rule: 'allow', comment: 'Coolify terminal' }

# Dokploy ports (when expose_platform_ports is true)
dokploy_ports:
  - { port: 3000, proto: 'tcp', rule: 'allow', comment: 'Dokploy dashboard' }

# Dokploy configuration
dokploy_port: 3000
dokploy_postgres_password: "{{ vault_dokploy_postgres_password | default('dokploy_secure_password') }}"

# Platform configurations
platform_configs:
  coolify:
    firewall_ports: "{{ coolify_ports if expose_platform_ports else [] }}"
  dokploy:
    firewall_ports: "{{ dokploy_ports if expose_platform_ports else [] }}"

# Current platform config based on server_role
current_platform_config: "{{ platform_configs[server_role] | default(platform_configs.coolify) }}"

# =============================================================================
# FIREWALL CONFIGURATION
# =============================================================================
# Default ports (always allowed)
default_firewall_ports:
  - { port: "{{ ssh_port }}", proto: 'tcp', rule: 'allow', comment: 'SSH' }

# Custom ports (define additional ports as needed)
custom_firewall_ports: []

# Final firewall rules (single source of truth)
# Combines: default + platform-specific + custom
firewall_rules: "{{ default_firewall_ports + current_platform_config.firewall_ports + custom_firewall_ports }}"

# =============================================================================
# SECURITY CONFIGURATION
# =============================================================================
fail2ban_bantime: 3600
fail2ban_findtime: 600
fail2ban_maxretry: 3

# =============================================================================
# SYSTEM REQUIREMENTS
# =============================================================================
min_cpu_cores: 2
min_memory_gb: 3
